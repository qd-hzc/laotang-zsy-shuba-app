<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>书</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<!--标准mui.css-->
		<link rel="stylesheet" href="../css/mui.min.css">
		<style>
			.my-font {
				font-size: 28px;
			}
		</style>
	</head>

	<body>
		<header id="header" class="mui-bar mui-bar-nav" style="padding-top: 10px;">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="padding-top: 0px;margin-right: 20px;"></a>
			<a id="zoom-jian" class="my-font">A-</a>
			<a id="zoom-jia" class="my-font" style="margin-left: 15px;">A＋</a>
		</header>
		<div id="content" class="mui-content" style="margin: 0px;padding: 0px;width: 300px !important;overflow: hidden;">
		</div>
	</body>

	<!--
    	作者：HZC
    	时间：2015-08-26
    	描述：图书
    -->
	<script src="../js/mui.min.js"></script>

	<script type="text/javascript">
		(function() {
			mui.plusReady(function() {
				plus.screen.lockOrientation("landscape");
				var self = plus.webview.currentWebview();
				var _href = self.href;
				window.scalKey = self.href.substr(_href.lastIndexOf('/') + 1);
				console.log(window.scalKey)
					//				_href = plus.io.convertLocalFileSystemURL('_downloads/scala-gailan.html');
				mui.init({
					swipeBack: false,
					statusBarBackground: '#f7f7f7',
					gestureConfig: {
						tap: true, //默认为true
						doubletap: true, //默认为false
						longtap: false, //默认为false
						swipe: false, //默认为true
						drag: false, //默认为true
						hold: false, //默认为false，不监听
						release: false //默认为false，不监听
					},
					subpages: [{
						id: 'pdf-id',
						url: _href,
						styles: {
							top: '45px',
							bottom: 0,
							bounce: 'vertical'
						}
					}]
				});
				setTimeout(function() {
					document.getElementById("header").style.display = 'none';
					var pdfW = plus.webview.getWebviewById('pdf-id');
					pdfW.setStyle({
						top: '0px',
						bottom: 0,
						bounce: 'vertical'
					})
					pdfW.hide()
					pdfW.show()
				}, 30000)
				setTimeout(function() {
					var pdfWin = plus.webview.getWebviewById("pdf-id");

					function saveScroll(sk) {
						var scroll_top = window.pdf2htmlEX.defaultViewer.a.scrollTop;
						console.log(sk);
						window.localStorage.setItem(sk, scroll_top);
					}
					pdfWin.evalJS(saveScroll.toString());
					var oldBack = mui.back;
					mui.back = function() {
						pdfWin.evalJS("window.saveScroll('" + window.scalKey + "')");
						plus.webview.currentWebview().opener().evalJS("mui.plusReady(function(){plus.screen.lockOrientation('portrait-primary');})")
						oldBack();
					};
					pdfWin.evalJS(scrol.toString() + ";window.scrol('" + window.scalKey + "');")

					function scrol(sk) {
						var t = window.localStorage.getItem(sk);
						console.log(sk)
						if (t) window.pdf2htmlEX.defaultViewer.a.scrollTop = parseFloat(t);
					}

					function zoom(s) {
						var zoomMeta = document.getElementById('zoom-meta-id');
						if (!zoomMeta) {
							var newEle = document.createElement('meta');
							newEle.setAttribute('id', 'zoom-meta-id');
							newEle.setAttribute('name', 'viewport');
							newEle.setAttribute('content', '')
							document.getElementsByTagName('head')[0].appendChild(newEle);
							zoomMeta = document.getElementById('zoom-meta-id');
						}
						var sss = window.localStorage.getItem(window.scalKey + 'scal');
						if (sss) s = parseFloat(sss);
						var c = 'width=device-width,initial-scale=' + s + ',minimum-scale=0.1,maximum-scale=10,user-scalable=yes';
						zoomMeta.setAttribute('content', c);
						var sty = document.createElement('style');
						sty.innerText = '#page-container{margin:-40px !important;}';
						document.getElementsByTagName('body')[0].appendChild(sty)
					}
					pdfWin.evalJS(zoom.toString());
					var ss = window.localStorage.getItem(window.scalKey + 'scal');
					window.zoom = ss ? parseFloat(ss) : 1;
					pdfWin.evalJS("window.zoom(" + ss + ")");
					document.getElementById("zoom-jia").addEventListener('tap', function() {
						window.zoom += 0.05;
						changeScale(window.zoom);
					});
					document.getElementById("zoom-jian").addEventListener('tap', function() {
						window.zoom -= 0.05;
						changeScale(window.zoom)
					})

					function changeScale(scale) {
						var s = scale;
						window.localStorage.setItem(window.scalKey + 'scal', s);
						pdfWin.evalJS("window.zoom(" + s + ")");
					}
				}, 2000)
			});
		})();
	</script>

</html>